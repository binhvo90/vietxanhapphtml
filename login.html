<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Đăng nhập - Việt Xanh</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
    <style>
      body {
        background: #ffffff;
        min-height: 100vh;
        font-family: Arial, Helvetica, sans-serif;
      }

      .login-shell {
        min-height: 100vh;
      }

      .illustration-wrap {
        min-height: 420px;
      }

      .scene {
        width: min(620px, 100%);
        aspect-ratio: 16/10;
        position: relative;
      }

      .monitor {
        position: absolute;
        inset: 12% 10% 12% 10%;
      }

      .screen {
        position: absolute;
        inset: 0 0 20% 0;
        border: 5px solid #d7d7d7;
        border-bottom-width: 9px;
        background: #fbfdff;
        overflow: hidden;
      }

      .base {
        position: absolute;
        left: 7%;
        right: 7%;
        bottom: 0;
        height: 16%;
        background: #d8d8d8;
      }

      .foot {
        position: absolute;
        left: 34%;
        width: 32%;
        height: 2.8%;
        bottom: -6%;
        background: #3f8bff;
      }

      .b, .b2, .b3, .b4 {
        position: absolute;
        border-radius: 999px;
        opacity: 0.6;
      }

      .b { width: 130px; height: 130px; left: -28px; bottom: 20px; background: #a7c7fb; }
      .b2 { width: 88px; height: 88px; left: -6px; top: 42px; background: #d3e3ff; }
      .b3 { width: 90px; height: 90px; right: -20px; top: 32px; background: #8db6f4; }
      .b4 { width: 108px; height: 108px; right: -28px; bottom: 28px; background: #dce9fd; }

      .paper {
        position: absolute;
        width: 40%;
        height: 54%;
        left: 33%;
        top: 20%;
        background: linear-gradient(145deg, #1f2d82, #1a245f);
        transform: rotate(-19deg);
      }

      .paper::after {
        content: "";
        position: absolute;
        width: 36%;
        height: 6%;
        left: 49%;
        top: 55%;
        border-radius: 999px;
        background: #ef5858;
      }

      .hand-a, .hand-b {
        position: absolute;
        height: 11%;
        border-radius: 999px;
        background: #ffc8bf;
      }

      .hand-a { width: 31%; left: 15%; top: 40%; transform: rotate(-23deg); }
      .hand-b { width: 30%; right: 19%; top: 33%; transform: rotate(23deg); }

      .pen {
        position: absolute;
        width: 25%;
        height: 2.8%;
        right: 28%;
        top: 30%;
        border-radius: 8px;
        background: #e84f4f;
        transform: rotate(-52deg);
      }

      .form-col {
        max-width: 430px;
      }

      .leaf {
        width: 96px;
        height: 56px;
        position: relative;
      }

      .leaf::before,
      .leaf::after {
        content: "";
        position: absolute;
        top: 0;
        width: 42px;
        height: 54px;
        border-radius: 85% 0 85% 0;
      }

      .leaf::before { left: 10px; background: #118c0d; transform: rotate(-35deg); }
      .leaf::after { right: 10px; background: #26cf12; transform: rotate(35deg) scaleX(-1); }

      .brand-name {
        font-size: clamp(44px, 5vw, 52px);
        font-style: italic;
        font-weight: 800;
        line-height: 1;
      }

      .section-title {
        color: #454545;
        font-size: 28px;
        font-weight: 700;
      }

      .title-line::before,
      .title-line::after {
        content: "";
        height: 1px;
        background: #d9d9d9;
        flex: 1;
      }

      .vx-input {
        height: 48px;
        border-radius: 2px;
        border-color: #bcbcbc;
        background: #f5f5f5;
        font-size: 1.15rem;
      }

      .vx-input::placeholder { color: #666; }

      .btn-login {
        background: #1f6ae5;
        color: #fff;
        font-weight: 700;
        min-width: 132px;
        height: 50px;
        border-radius: 6px;
        box-shadow: 0 2px 8px rgba(31, 106, 229, 0.35);
      }

      .btn-login:hover { background: #1858be; color: #fff; }

      .feedback {
        min-height: 24px;
        font-size: .95rem;
      }

      @media (max-width: 991.98px) {
        .illustration-col { order: 2; }
        .form-col-wrap { order: 1; }
      }
    </style>
  </head>
  <body>
    <main class="container login-shell d-flex align-items-center">
      <div class="row align-items-center w-100 g-4">
        <section class="col-lg-7 illustration-col">
          <div class="illustration-wrap d-flex align-items-center justify-content-center">
            <div class="scene" aria-hidden="true">
              <div class="monitor">
                <div class="screen">
                  <div class="b"></div>
                  <div class="b2"></div>
                  <div class="b3"></div>
                  <div class="b4"></div>
                  <div class="paper"></div>
                  <div class="hand-a"></div>
                  <div class="hand-b"></div>
                  <div class="pen"></div>
                </div>
                <div class="base"></div>
                <div class="foot"></div>
              </div>
            </div>
          </div>
        </section>

        <section class="col-lg-5 form-col-wrap">
          <div class="form-col mx-auto">
            <div class="d-flex flex-column align-items-center mb-3">
              <div class="leaf"></div>
              <h1 class="brand-name m-0">Việt Xanh</h1>
            </div>

            <div class="title-line d-flex align-items-center gap-3 mb-4">
              <span class="section-title">Đăng nhập</span>
            </div>

            <form id="loginForm" novalidate>
              <div class="mb-3">
                <input id="username" name="username" type="text" class="form-control vx-input" placeholder="Nhập Mã NS hoặc Số ĐT:" autocomplete="username" required />
              </div>
              <div class="mb-2">
                <input id="pin" name="pin" type="password" class="form-control vx-input" placeholder="Mã PIN:" autocomplete="current-password" required minlength="4" />
              </div>

              <div class="d-flex justify-content-between align-items-center small text-secondary mb-2">
                <label class="d-inline-flex align-items-center gap-2">
                  <input class="form-check-input m-0" type="checkbox" id="remember" />
                  <span>Lưu trạng thái đăng nhập</span>
                </label>
                <a href="#" class="text-decoration-none text-secondary">Quên mã PIN</a>
              </div>

              <div id="feedback" class="feedback mb-2" role="alert" aria-live="polite"></div>

              <button id="loginBtn" type="submit" class="btn btn-login">ĐĂNG NHẬP</button>
            </form>
          </div>
        </section>
      </div>
    </main>

    <script>
      const form = document.getElementById('loginForm');
      const feedback = document.getElementById('feedback');
      const loginBtn = document.getElementById('loginBtn');

      const demoAccount = { username: 'admin', pin: '123456' };
      let failedAttempts = 0;
      let lockUntil = 0;

      function setFeedback(message, type = '') {
        feedback.textContent = message;
        feedback.className = `feedback mb-2 ${type}`.trim();
      }

      function remainingLockSeconds() {
        return Math.max(0, Math.ceil((lockUntil - Date.now()) / 1000));
      }

      function applyLockState() {
        const seconds = remainingLockSeconds();
        if (seconds > 0) {
          loginBtn.disabled = true;
          setFeedback(`Sai mã PIN quá 3 lần. Vui lòng thử lại sau ${seconds}s.`, 'text-danger');
          return true;
        }
        loginBtn.disabled = false;
        return false;
      }

      const lockTicker = setInterval(() => {
        if (!applyLockState()) {
          if (failedAttempts === 0 && !feedback.classList.contains('text-success')) {
            setFeedback('');
          }
          if (lockUntil > 0 && remainingLockSeconds() === 0) {
            lockUntil = 0;
          }
        }
      }, 1000);

      window.addEventListener('beforeunload', () => clearInterval(lockTicker));

      form.addEventListener('submit', (event) => {
        event.preventDefault();

        if (applyLockState()) return;

        const username = form.username.value.trim();
        const pin = form.pin.value.trim();

        if (!username || !pin) {
          setFeedback('Vui lòng nhập đầy đủ tài khoản và mã PIN.', 'text-danger');
          return;
        }

        if (username === demoAccount.username && pin === demoAccount.pin) {
          failedAttempts = 0;
          lockUntil = 0;
          setFeedback('Đăng nhập thành công!', 'text-success');
          return;
        }

        failedAttempts += 1;
        const remaining = 3 - failedAttempts;

        if (remaining <= 0) {
          lockUntil = Date.now() + 30 * 1000;
          applyLockState();
        } else {
          setFeedback(`Sai tài khoản hoặc mã PIN. Bạn còn ${remaining} lần thử.`, 'text-danger');
        }
      });
    </script>
  </body>
</html>
